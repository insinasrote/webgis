// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(R,D,x,n,b,m,p,T){function U(b,d){this.start=b;this.end=d}function l(b,d,f){this.start=b;this.end=d;this.units=f}function g(b,d){this.start=b;this.end=d;this.temp=new n}function C(b){this.values=b;this.length=b.length}function J(b,d){this.values=b;this.def=d?d:{}}function F(b,d){this.stack=b;this.original=d}function u(b,
d,f,l){if(b.values)return new C(b.values);var w,z;z=b.start?D.normalizeColor(b.start):w=d?f?d[f]:d:l;b.end?b=D.normalizeColor(b.end):(w||(w=d?f?d[f]:d:l),b=w);return new g(z,b)}var A=D.fx={};U.prototype.getValue=function(b){return(this.end-this.start)*b+this.start};l.prototype.getValue=function(b){return(this.end-this.start)*b+this.start+this.units};g.prototype.getValue=function(b){return n.blendColors(this.start,this.end,b,this.temp)};C.prototype.getValue=function(b){return this.values[Math.min(Math.floor(b*
this.length),this.length-1)]};J.prototype.getValue=function(b){var d=R.clone(this.def),f;for(f in this.values)d[f]=this.values[f].getValue(b);return d};F.prototype.getValue=function(g){var d=[];b.forEach(this.stack,function(f){if(f instanceof x.Matrix2D)d.push(f);else if("original"==f.name&&this.original)d.push(this.original);else if("matrix"==f.name){if(f.start instanceof x.Matrix2D&&f.end instanceof x.Matrix2D){var l=new x.Matrix2D,w;for(w in f.start)l[w]=(f.end[w]-f.start[w])*g+f.start[w];d.push(l)}}else f.name in
x&&(l=x[f.name],"function"!=typeof l?d.push(l):(w=b.map(f.start,function(b,d){return(f.end[d]-b)*g+b}),l=l.apply(x,w),l instanceof x.Matrix2D&&d.push(l)))},this);return d};var E=new n(0,0,0,0);A.animateStroke=function(b){b.easing||(b.easing=m._defaultEasing);var d=new m.Animation(b),f=b.shape,g;p.connect(d,"beforeBegin",d,function(){g=f.getStroke();var d=b.color,l={},m;d&&(l.color=u(d,g,"color",E));(d=b.style)&&d.values&&(l.style=new C(d.values));if(d=b.width){var z=d,p=g;z.values?m=new C(z.values):
(d=z.start?z.start:m=p?p.width:1,z.end?m=z.end:"number"!=typeof m&&(m=p?p.width:1),m=new U(d,m));l.width=m}(d=b.cap)&&d.values&&(l.cap=new C(d.values));if(d=b.join)d.values?l.join=new C(d.values):(m=d.start?d.start:g&&g.join||0,d=d.end?d.end:g&&g.join||0,"number"==typeof m&&"number"==typeof d&&(l.join=new U(m,d)));this.curve=new J(l,g)});p.connect(d,"onAnimate",f,"setStroke");return d};A.animateFill=function(b){b.easing||(b.easing=m._defaultEasing);var d=new m.Animation(b),f=b.shape,g;p.connect(d,
"beforeBegin",d,function(){g=f.getFill();var d=b.color;d&&(this.curve=u(d,g,"",E))});p.connect(d,"onAnimate",f,"setFill");return d};A.animateFont=function(b){b.easing||(b.easing=m._defaultEasing);var d=new m.Animation(b),f=b.shape,g;p.connect(d,"beforeBegin",d,function(){g=f.getFont();var d=b.style,m={},p,n;d&&d.values&&(m.style=new C(d.values));(d=b.variant)&&d.values&&(m.variant=new C(d.values));(d=b.weight)&&d.values&&(m.weight=new C(d.values));(d=b.family)&&d.values&&(m.family=new C(d.values));
(d=b.size)&&d.units&&(p=parseFloat(d.start?d.start:f.font&&f.font.size||"0"),n=parseFloat(d.end?d.end:f.font&&f.font.size||"0"),m.size=new l(p,n,d.units));this.curve=new J(m,g)});p.connect(d,"onAnimate",f,"setFont");return d};A.animateTransform=function(g){g.easing||(g.easing=m._defaultEasing);var d=new m.Animation(g),f=g.shape,l;p.connect(d,"beforeBegin",d,function(){l=f.getTransform();this.curve=new F(g.transform,l)});p.connect(d,"onAnimate",f,"setTransform");if("svg"===D.renderer&&(9<=T("ie")||
T("ff")))var n=[p.connect(d,"onBegin",d,function(){for(var b=f.getParent();b&&b.getParent;)b=b.getParent();b&&(f.__svgContainer=b.rawNode.parentNode,f.__svgRoot=b.rawNode,f.__svgRoot&&f.__svgRoot.getAttribute&&(f.__svgWidth=parseInt(f.__svgRoot.getAttribute("width"),10),isNaN(f.__svgWidth)&&delete f.__svgWidth))}),p.connect(d,"onAnimate",d,function(){try{if(f.__svgContainer){var b=f.__svgContainer.style.visibility;f.__svgContainer.style.visibility="visible";f.__svgContainer.style.visibility=b;var d=
f.__svgWidth;if(!isNaN(d))try{f.__svgRoot.setAttribute("width",d-5E-6),f.__svgRoot.setAttribute("width",d)}catch(V){}}}catch(V){}}),p.connect(d,"onEnd",d,function(){b.forEach(n,p.disconnect);if(f.__svgContainer){var d=f.__svgContainer;if(null==d.getAttribute("__gotVis")){d.setAttribute("__gotVis",!0);var g=f.__svgContainer.style.visibility,l=f.__svgRoot,m=f.__svgWidth;d.style.visibility="visible";setTimeout(function(){try{d.style.visibility=g;d.removeAttribute("__gotVis");d=null;try{isNaN(m)||(l.setAttribute("width",
m-5E-6),l.setAttribute("width",m))}catch(O){}}catch(O){}},100)}}delete f.__svgContainer;delete f.__svgRoot;delete f.__svgWidth})];return d};return A})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(R,D,x,n,b,m,p,T,U,l,g,C,J,F,u,A,E,z,d,f,ba,w,Z,H,V,G,O,W,aa){return R("ClusterLayer",[F,C],{constructor:function(h){this.clusterGraphics=[];this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=void 0;this.hidePanel=h.hidePanel;this._parent=h._parent;if(this._parentLayer=h.parentLayer)this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields;this.name=h.name;this._map=h.map;this.color=b.fromString(h.color||"#ff0000");
this._styleColor=h._styleColor;this.symbolData=h.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=h.lyrInfo.itemId;this.refresh=h.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=h.node;this.countEnabled=h.countEnabled;this.legendNode=h.legendNode;this.id=h.id;this.infoTemplate=h.infoTemplate;this.url=h.lyrInfo.url;this._testRenderer=h.lyrInfo.renderer;(this.originOperLayer=h.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);
this.lyrInfo=h.lyrInfo;this.lyrType=h.lyrType;this.filter=h.filter;this.showAllFeatures=h.showAllFeatures;this.listDisabled=h.listDisabled;this.selfType=h.selfType;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(n.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(b){var h=new H;h.geometry=this.showAllFeatures?b.fullExtent:this._map.extent;b.queryCount?b.queryCount(h,n.hitch(this,
function(h){if(0<h)this.hidePanel||(this.nodeCount=h),this._initFeatures(this._parentLayer);else if(!this.hidePanel)if(this.nodeCount=0,b.url){var d=new aa(b.url);g(d,"load",n.hitch(this,function(){this.countFeatures(d)}))}else this._initFeatures(this._parentLayer)})):this._initFeatures(this._parentLayer)},_initFeatures:function(b){this._features=[];var h=!0,d=new H;(-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||!this.url)&&b.graphics?(this._getSourceFeatures(b.graphics),this.clusterFeatures()):
"undefined"!==typeof this.url?this.loadData(this.url):(d.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1",d.outFields=["*"],d.returnGeometry=!0,b.queryFeatures?b.queryFeatures(d).then(n.hitch(this,function(b){b.features&&(this._getSourceFeatures(b.features),this.clusterFeatures())})):h="error");"error"!==h&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",n.hitch(this,this.handleMapExtentChange))),this.clickSignal||(this.clickSignal=this.on("click",n.hitch(this,
this.handleClick))))},_getSourceFeatures:function(b){this._features=[];for(var h=0;h<b.length;h++){var d=b[h];d.geometry&&this._features.push(d)}},_getInfoTemplate:function(b){b=b.parentLayerInfo?b.parentLayerInfo:b;if(b.controlPopupInfo&&(b=b.controlPopupInfo.infoTemplates)){if(this.url){var h=this.url.split("/").pop();h&&(b.indexOf?-1<b.indexOf(h)&&(this.infoTemplate=b[h].infoTemplate):b.hasOwnProperty(h)&&(this.infoTemplate=b[h].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=
[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var b=this.infoTemplate.info.fieldInfos;if(b)for(var d=0;d<b.length;d++)b[d].visible&&this._fieldNames.push(b[d].fieldName)}if(this.symbolData.featureDisplayOptions&&0<this.symbolData.featureDisplayOptions.fields.length)for(b=0;b<this.symbolData.featureDisplayOptions.fields.length;b++)d=this.symbolData.featureDisplayOptions.fields[b],-1===this._fieldNames.indexOf(d.name)&&this._fieldNames.push(d.name);1>this._fieldNames.length&&
(this._fieldNames=["*"])},setLayerInfo:function(b){this.lyrInfo=b},clearSingles:function(b){D.forEach(b||this._singles,function(b){this.remove(b)},this);this._singles.length=0},_getSingleGraphic:function(b){b=new u(new E(b.geometry.x,b.geometry.y,this._map.spatialReference),null,b.attributes);b.setSymbol(this._singleSym);return b},_addSingles:function(b){D.forEach(b,function(b){b=this._getSingleGraphic(b);this._singles.push(b);this._showSingles&&this.add(b)},this);this._map.infoWindow.setFeatures(this._singles)},
initalCount:function(b){if(!this.hidePanel){var h=new H;h.returnGeometry=!1;h.geometry=this.showAllFeatures?null:this._map.extent;h.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1";(new V(b)).executeForIds(h).then(n.hitch(this,function(b){var h;this.node?(T.contains(this.node,"searching")&&T.remove(this.node,"searching"),this.node.innerHTML=b?J.localizeNumber(b.length):0,h=this.node.parentNode):this.legendNode&&(h=this.legendNode.previousSibling);this.updateExpand(h,b?!1:!0)}))}},updateExpand:function(b,
d){if(!this.hidePanel&&"undefined"!==typeof b){var h;-1<b.id.indexOf("rec_")&&(h=b.id.replace("rec_",""),h=U.byId("exp_"+h));d?(b&&(m.addClass(b,"recDefault"),m.addClass(b,"inActive")),h&&m.addClass(h,"expandInActive")):this.visible&&(b&&(m.removeClass(b,"recDefault"),m.removeClass(b,"inActive")),h&&m.removeClass(h,"expandInActive"))}},loadData:function(b){if(0<b.length){this.initalCount(b);var h=new H;h.where="1\x3d1";this.filter&&(h.where=this.filter);h.returnGeometry=!1;this.queryPending=!0;(new V(b)).executeForIds(h).then(n.hitch(this,
function(h){var d=this._parentLayer&&this._parentLayer.maxRecordCount?this._parentLayer.maxRecordCount:1E3;if(h){this.queryIDs=h;h=[];var g,f;g=0;for(f=this.queryIDs.length;g<f;g+=d){var l=this.queryIDs.slice(g,g+d),m=new H;m.outFields=["*"];m.objectIds=l;m.returnGeometry=!0;m.outSpatialReference=this._map.spatialReference;l=new V(b);h.push(l.execute(m))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new p(h)).then(n.hitch(this,function(b){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");
else if(b){for(var a=this._map.spatialReference,c=[],e=0;e<b.length;e++)if(b[e][1].features)for(var t=0;t<b[e][1].features.length;t++){var r=b[e][1].features[t];if("undefined"!==typeof r.geometry&&null!==r.geometry&&r.geometry){var k=new E(r.geometry.x,r.geometry.y,a),k=new u(k);k.setAttributes(r.attributes);this.infoTemplate&&k.setInfoTemplate(this.infoTemplate);c.push(k)}}b=!0;1E4>c&&(b=JSON.stringify(this._features)!==JSON.stringify(c));b&&(this.requiresReload=!0,this._features=c,this.clusterFeatures(),
this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},handleClick:function(b){var h=[];if(b.graphic&&(h=b.graphic,h.attributes)){var d=h.attributes;d.Data&&1<d.Data.length?(this.clearSingles(this._singles),h=d.Data,b.stopPropagation(),this._addSingles(h)):d.Data&&1===d.Data.length?(d.Data[0].symbol=h.symbol,this._map.infoWindow.setFeatures([d.Data[0]])):this._map.infoWindow.setFeatures([h])}this.infoTemplate&&this._map.infoWindow.show(b.mapPoint);x.stop(b)},handleMapExtentChange:function(b){if(b.levelChange)this.clusterFeatures();
else if(b.delta){b=b.delta;var d=Math.abs(b.y);(50<Math.abs(b.x)||50<d)&&this.clusterFeatures()}},refreshFeatures:function(b){if(this.itemId){var d=b.featureSet.features;b.featureSet.transform&&(d=(new G(b.featureSet)).features);"undefined"===typeof this.updateFeatures&&(this.updateFeatures=d);b=!0;1E4>d.length&&(b=JSON.stringify(this.updateFeatures)!==JSON.stringify(d));if(b){this.requiresReload=!0;this._features=[];this._parentLayer.clear();b=this._parentLayer.spatialReference;for(var h=0;h<d.length;h++){var g=
d[h];if(g.geometry){var f=new u(this.getGraphicOptions(g,b));f.setAttributes(g.attributes);this.infoTemplate&&f.setInfoTemplate(this.infoTemplate);this._parentLayer.add(f);this._features.push(f)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=d}else this.url&&this.loadData(this.url)},getGraphicOptions:function(b,d){return"undefined"!==typeof b.geometry.rings?{geometry:{rings:b.geometry.rings,spatialReference:{wkid:d.wkid}}}:"undefined"!==typeof b.geometry.paths?
{geometry:{paths:b.geometry.paths,spatialReference:{wkid:d.wkid}}}:"undefined"!==typeof b.geometry.points?{geometry:{points:b.geometry.points,spatialReference:{wkid:d.wkid}}}:{geometry:new E(b.geometry.x,b.geometry.y,b.geometry.spatialReference)}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},flashSingle:function(h){if("undefined"===typeof h.symbol){var g=new f(f.STYLE_NULL,new b(0,0,0,0),0),l=this.color.toRgb();h.setSymbol(new d(d.STYLE_CIRCLE,9,g,new b([l[0],
l[1],l[2],.5])))}this.flashGraphics([h])},flashGraphics:function(b){for(var d=0;d<b.length;d++)this._flashFeature(b[d]);setTimeout(n.hitch(this,this._clearFeatures),1100)},_flashFeature:function(h){var g;if(h.geometry){var m=b.fromHex(this._styleColor),X=n.clone(m);X.a=.4;"undefined"!==typeof h.symbol&&(g=new d(d.STYLE_CIRCLE,h.symbol.size,new f(f.STYLE_SOLID,m,1),X))}"undefined"!==typeof g&&(h=new u(h.geometry,g),this._map.graphics.add(h),g=h.getDojoShape())&&(l.animateStroke({shape:g,duration:700,
color:{start:g.strokeStyle.color,end:g.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,h))},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(b){b.getLayer().remove(b)},setColor:function(b){this.color=b},setStyleColor:function(b){this._styleColor=b},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&
(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&this._map.infoWindow.hide();var b=this._features,d=0;if("undefined"!==typeof b){if(0<b.length&&(this.visible||this.requiresReload)){var g=this.clusterSize;this.clusterGraphics=[];for(var f=this._map.spatialReference,l=this._map.extent,m=new E(l.xmin,
l.ymax,f),p=Math.ceil(this._map.height/g),v=Math.ceil(this._map.width/g),n=l.getWidth()/this._map.width*g,g=l.getHeight()/this._map.height*g,l=0;l<p;l++)for(var a=0;a<v;a++){var c=m.x+n*a,e=m.y-g*l,e=new A(c,e-g,c+n,e,f),c=[],t;for(t in b){var r=b[t];e.contains(r.geometry)&&(d+=1,c.push(r))}0<c.length&&(e=this.getClusterCenter(c),this.clusterGraphics.push({center:e,graphics:c}))}for(var k in this.clusterGraphics){f=this.clusterGraphics[k];m=f.graphics.length;p=f.graphics;t=J.localizeNumber(m);n=v=
19*t.length;v+=5;g=new w;g.family="Arial";g.size="16px";t=new ba(t,g,this.countColor);t.setOffset(0,-4);var y;this.symbolData&&this.symbolData.symbol?this.symbolData.symbol.size?y=this.symbolData.symbol.size:this.symbolData.symbol.width&&(y=this.symbolData.symbol.width,g=this.symbolData.symbol.height,y=y>=g?y:g):this.icon.width?(v=this.icon.width>=v?this.icon.width+5:v,v=this.icon.height>=v?this.icon.height+5:v,n=this.icon.width>=n?this.icon.width+1:n,n=this.icon.height>=n?this.icon.height+1:n):this.icon.size&&
(y=this.icon.size);y&&(v=y>=v?y+5:v,n=y>=n?y+1:n);n>=v&&(v+=0===n-v?4:n-v+5);this._setSymbols(v+15,v);p={Count:m,Data:p};1<m?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new u(f.center,this.csym,p)),this.displayFeatureCount?this.add(new u(f.center,t,p)):this.add(new u(f.center,this.csym3,p))):(this.add(new u(f.center,this.csym,p)),this.displayFeatureCount?this.add(new u(f.center,t,p)):this.add(new u(f.center,this.psym,p))):(this.add(new u(f.center,this.csym,
p)),this.displayFeatureCount?this.add(new u(f.center,t,p)):this.add(new u(f.center,this.psym,p))):(f=f.graphics[0].geometry,this.renderer&&(f=(this.renderer.hasOwnProperty("getSymbol")||this.renderer.hasOwnProperty("symbol"))&&"LayerSymbol"===this.symbolData.symbolType?new u(f,null,p.Data[0].attributes,this.infoTemplate):"EsriSymbol"===this.symbolData.symbolType?new u(f,O.fromJson(this.symbolData.symbol),p,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new u(f,this.psym,p,this.infoTemplate):
this.renderer.symbol?new u(f,null,p,this.infoTemplate):new u(f,this.psym,p,this.infoTemplate),"undefined"!==typeof f&&this.add(f)))}}this._updateNode(this.showAllFeatures?b.length:d)}},_updateNode:function(b){if(!this.hidePanel){var d;this.node?(this.node.innerHTML=J.localizeNumber(b?b:0),d=this.node.parentNode):this.legendNode&&(d=this.legendNode.previousSibling);this.updateExpand(d,b&&0<b&&this.visible?!1:!0)}},_setSymbols:function(h,g){var l=this.color.toRgb(),m,p,x;if("undefined"!==typeof this.symbolData){var u;
"custom"===this.backgroundClusterSymbol?u=l:(m=O.fromJson(this.backgroundClusterSymbol),0===m.outline.color.a||0===m.outline.width?(p=f.STYLE_NULL,x=0):(p=f.STYLE_SOLID,x=m.outline.width));m?(l=f(p,m.outline.color,x),u=m.color.toRgb(),this.csym=new d(d.STYLE_CIRCLE,h,l,new b([u[0],u[1],u[2],.75]))):this.csym=new d(d.STYLE_CIRCLE,h,null,new b([u[0],u[1],u[2],.75]));(h=this.symbolData.s)&&-1<h.indexOf("${appPath}")?(h=window.location.pathname.replace("index.html",""),h=this.symbolData.s.replace("${appPath}",
window.location.origin+h)):h=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(h&&"CustomIcon"===this.symbolData.iconType){var v,w;this.symbolData.symbol&&this.symbolData.symbol.height&&(v=this.symbolData.symbol.height);this.symbolData.symbol&&this.symbolData.symbol.width&&(w=this.symbolData.symbol.width);v&&w?w=v=w>v?w:v:(v=this.symbolData.icon.height?this.symbolData.icon.height:g,w=this.symbolData.icon.width?this.symbolData.icon.width:g);this.psym=new z(h,v,w)}else h&&"LayerIcon"===this.symbolData.iconType?
this.psym=O.fromJson(this.symbolData.symbol):"esriPMS"===this.icon.type?this.psym=this.icon:(g=f(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),this.psym=new d(this.icon.style,this.icon.size,g,this.icon.color));this.csym2=n.clone(this.psym);this.csym3=n.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else v=new f(f.STYLE_NULL,new b(0,0,0,0),0),this.csym=new d(d.STYLE_CIRCLE,
h,v,new b([l[0],l[1],l[2],.5])),this.psym=new z(this.icon.url,h-10,h-10),this.psym2=new z(this.icon.url,g-7,g-7),v=new f(f.STYLE_NULL,new b(0,0,0,0),0),this.csym2=new d(d.STYLE_CIRCLE,g,v,new b([l[0],l[1],l[2],.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=
this._parentLayer.renderer.toJson?this._parentLayer.renderer:W.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=W.fromJson(this._testRenderer):this.symbolData.renderer&&(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:W.fromJson(this.symbolData.renderer)):this.renderer=new Z(O.fromJson(this.symbolData.symbol));var g=this.color.toRgb(),l=new f(f.STYLE_NULL,new b(0,0,0,0),0);this._singleSym=new d(d.STYLE_CIRCLE,9,l,new b([g[0],g[1],g[2],.5]))}},getLayer:function(){return this},
getClusterCenter:function(b){var d=0,g=0,h=b.length;D.forEach(b,function(b){d+=b.geometry.x;g+=b.geometry.y},this);return new E(d/h,g/h,b[0].geometry.spatialReference)},destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=[]},_updateEnd:function(){this.url&&this.loadData(this.url)}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},
"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page" data-dojo-attach-point\x3d"panelPage"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader pageHeader-border roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody roundedBottom" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary {width: 100%; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem:hover {background-color: lightgray;}.jimu-widget-InfoSummary .layer-row-mouseover-dashboard {background-color: #3d3d3d !important;}.jimu-widget-InfoSummary .rec:hover .expandUp-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #222; bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandUp-dashboard {background-image: url(../images/_nav_up.png); bottom: -1px; background-color: #222; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemImage-dashboard {width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #6d6d6d;}.jimu-widget-InfoSummary .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem-dart:hover {background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart {background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart {background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 10px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table; line-height: 30px;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none !important;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 100%; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 100%; margin-left: 0px; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; overflow: hidden; display: block;}.jimu-widget-InfoSummary .pageHeader-border {border-bottom: 1px solid lightgray;}.jimu-widget-InfoSummary .pageHeader-border-dart {border-bottom: 1px solid black;}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 180px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh-tab {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated-tab {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 10px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 180px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .active {opacity: 0.8; filter: alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {opacity: 0.8; filter: alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px; vertical-align: middle;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px; vertical-align: middle;}.jimu-widget-InfoSummary .inActive {opacity: 0.6; filter: alpha(opacity\x3d60);}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 0px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 25px; text-align: center; display: block;}.jimu-widget-InfoSummary .solidBorder {border-bottom: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .imageDataGFX {display: block; float: left; width: 30px; height: 30px; margin-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {display: block; float: right; width: 30px; height: 30px; margin-right: 10px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; cursor: pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor: pointer;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover {background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart {background-color: rgba(0,0,0,.5);}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent{} .jimu-widget-InfoSummary .pageHeader{position: relative; width: 100%; height: 0px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 45px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 25px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 0px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 45px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}}",
"*now":function(R){R(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/DeferredList dojo/Deferred dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(R,
D,x,n,b,m,p,T,U,l,g,C,J,F,u,A,E,z,d,f,ba,w,Z,H,V,G,O,W,aa,h,fa,ha,X,ca,ga,da,v,ea){return U([R,ba],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],row:null,postCreate:function(){this.inherited(arguments);this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=this.config.layerInfos;this.layerList=
{};this._initWidget()},_forceClose:function(){var a=this.appConfig.theme.name,c=this.getPanel();if(-1<"LaunchpadTheme DartTheme FoldableTheme JewelryBoxTheme BillboardTheme TabTheme DashboardTheme".split(" ").indexOf(a))c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",this.widgetManager.closeWidget(this.id);else if("BoxTheme"===a){if(c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",c.getParent&&c.getParent()._toggleBox)for(var a=
E(".icon-node-active"),e=0;e<a.length;e++)-1<a[e].outerHTML.indexOf(this.id)&&c.getParent()._toggleBox()}else if("PlateauTheme"===a)if(c.containerNode.parentNode.style.display="none",c.containerNode.style.display="none",this.widgetManager.closeWidget(this.id),this.aw)this.aw._switchNodeToClose(this.id),this.aw._closeDropMenu();else for(c=this.widgetManager.appConfig.widgetOnScreen.widgets,a=0;a<this.widgetManager.appConfig.widgetOnScreen.widgets.length;a++)if(c[a].isThemeWidget){this.aw=this.widgetManager.getWidgetById(c[a].id);
this.aw._switchNodeToClose(this.id);this.aw._closeDropMenu();break}},inPanelOverrides:function(a){"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0);var c=this.getPanel();if(this.config.hidePanel)if(c=["DartTheme","BoxTheme","FoldableTheme","JewelryBoxTheme","PlateauTheme"],"LaunchpadTheme"===a)this._forceClose(),a=E(".selected"),0<a.length&&-1<a[0].parentNode.outerHTML.indexOf(this.id)&&(this.iconClickHandler=p(a[0],"click",l.hitch(this,this._forceClose)));
else{if(-1<c.indexOf(a))for("BoxTheme"===a&&this._forceClose(),a=E(".icon-node"),c=0;c<a.length;c++)-1<a[c].outerHTML.indexOf(this.id)&&(this.iconClickHandler=p(a[c],"click",l.hitch(this,this._forceClose)))}else switch(c.containerNode&&c.containerNode.firstChild&&c.containerNode.firstChild.className&&(c.containerNode.firstChild.style.padding="0px 0px 10px 0px"),-1===["TabTheme","BillboardTheme","PlateauTheme","DashboardTheme"].indexOf(a)&&this._updateBackgroundColors(!0),this.isDartTheme="DartTheme"===
a,this.isDashboardTheme="DashboardTheme"===a,b.contains(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart")&&b.remove(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart"),b.add(this.pageHeader,this.isDartTheme?"pageHeader-border-dart":"pageHeader-border"),a){case "DartTheme":this.updateForDartTheme(c);break;case "BoxTheme":this.updateForBoxTheme(c);break;case "TabTheme":this.updateForTabTheme(c);break;case "LaunchpadTheme":this.updateForLaunchpadTheme(c);
break;case "BillboardTheme":this.updateForBillboardTheme(c);break;case "PlateauTheme":this.updateForPlateauTheme(c);break;case "DashboardTheme":this.updateForDashboardTheme(c)}},updateForLaunchpadTheme:function(a){a.containerNode.style.top="30px"},updateForTabTheme:function(a){if(0<a.containerNode.children.length){var c=a.containerNode.children[0];1<c.children.length&&(c.children[1].style.padding="14px 0px 14px 0px")}a.config.isOnScreen||this._updateBackgroundColors(!1)},updateForBoxTheme:function(a){a.containerNode.parentNode.style.top=
"140px"},updateForDartTheme:function(a){a.containerNode.style.right="0px";a.containerNode.style.left="0px"},updateForBillboardTheme:function(){this._updateBackgroundColors(!1)},updateForPlateauTheme:function(){this._updateBackgroundColors(!1)},updateForDashboardTheme:function(){this._updateBackgroundColors(!1)},_updateBackgroundColors:function(a){b.contains(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated")&&b.remove(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated");b.add(this.lastUpdated,a?"lastUpdated":
"lastUpdated-tab");a=a&&"DashboardTheme"!==this.appConfig.theme.name;this.useDarkText=!a;b.contains(this.pageHeader,"jimu-main-background")&&!a?b.remove(this.pageHeader,"jimu-main-background"):!b.contains(this.pageHeader,"jimu-main-background")&&a&&b.add(this.pageHeader,"jimu-main-background");b.contains(this.pageHeader,"dart-bgcolor")&&!a?b.remove(this.pageHeader,"dart-bgcolor"):!b.contains(this.pageHeader,"dart-bgcolor")&&a&&b.add(this.pageHeader,"dart-bgcolor");b.contains(this.pageHeader,"box-bgcolor")&&
!a?b.remove(this.pageHeader,"box-bgcolor"):!b.contains(this.pageHeader,"box-bgcolor")&&a&&b.add(this.pageHeader,"box-bgcolor")},startup:function(){this.inherited(arguments);this.hidePanel||this.showAllFeatures?this.showAllFeatures&&this._mapExtentChange():(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),this._mapExtentChange())},onOpen:function(){this.widgetChange=!1;this.hidePanel?"BoxTheme"!==this.appConfig.theme.name&&this._forceClose():this._updatePanelHeader();
this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);var a=[],c;for(c in this.layerList){var e=this.layerList[c],b=e.li,r=e.layerObject;if(b&&b.orgRenderer){if(r.setRenderer)r.setRenderer(b.newRenderer);else if(r.setLayerDrawingOptions){var k=[],d=new ea;d.renderer=b.newRenderer;k[b.subLayerId]=d;r.setLayerDrawingOptions(k)}else console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof r.refresh&&
r.refresh()}var q;r&&r.layerInfos?q=r:b&&"undefined"!==typeof b.parentLayerID&&(q=this.map.getLayer(b.parentLayerID));if(q&&q.visibleLayers){r=!1;k=0;a:for(;k<a.length;k++)if(a[k].id===q.id){r=!0;break a}0!==a.length&&r||a.push({id:q.id,layers:q.visibleLayers});r=0;r;a:for(;r<a.length;r++)if(a[r].id===q.id)break a;k=a[r].layers;if(q.layerInfos){if(0<q.layerInfos.length&&b&&"undefined"!==typeof b.subLayerId){var d=-1<k.indexOf(b.subLayerId),g=e.parentLayerVisible,h=e.layerObject.parentLayerVisible;
"ClusterLayer"===e.type&&(d||g||h)?(e.parentLayerVisible=!0,e.layerObject.parentLayerVisible=!0,e.visible=!0,d&&k.splice(k.indexOf(b.subLayerId),1)):d||g?(e.parentLayerVisible=!0,e.visible=!0,-1===k.indexOf(b.subLayerId)&&k.push(b.subLayerId)):(e.parentLayerVisible=!1,e.visible=!1,d&&k.splice(k.indexOf(b.subLayerId),1),"ClusterLayer"===e.type&&(e.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(e.id)&&(b=this.map.getLayer(e.id),b.setVisibility(!1))))}a[r].layers=k}this.updatePanelVisibility(e,
c,e)}else r&&("ClusterLayer"===e.type&&r._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(e.id)&&(b=this.map.getLayer(e.id),"undefined"===typeof e.layerObject.parentLayerVisible&&(e.parentLayerVisible=r._parentLayer.visible,e.layerObject.parentLayerVisible=r._parentLayer.visible),b.setVisibility(e.layerObject.parentLayerVisible)),r._parentLayer.setVisibility&&r._parentLayer.setVisibility(!1)),this.updatePanelVisibility(r,c,e));this.showAllFeatures&&this.config.expandList&&e.legendOpen&&!e.isLoaded&&
(b=e.visScaleRange,"undefined"!==typeof b&&(b=this._inVisibleRange(e,c)),e.visible&&b&&(e.updateList=!0))}for(c=0;c<a.length;c++)(e=this.map.getLayer(a[c].id))&&e.setVisibleLayers(a[c].layers);this.hidePanel||this.showAllFeatures||"undefined"!==typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler=this.map.on("extent-change",l.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow&&(this.map.infoWindow.highlight=
!0)},updatePanelVisibility:function(a,c,e){if(!this.hidePanel&&"undefined"!==typeof a.visible){var t=e.visScaleRange,r=n.byId("recLabel_"+c);a.visible?(b.contains("recIcon_"+c,"active")||b.add("recIcon_"+c,"active"),this.config.countEnabled&&b.contains("recNum_"+c,"recNumInActive")&&(b.remove("recNum_"+c,"recNumInActive"),b.add("recNum_"+c,"recNum")),r&&r.firstChild&&b.remove(r.firstChild,"inActive"),e.listDisabled||("undefined"===typeof t||t)&&b.contains("exp_"+c,"expandInActive")&&b.remove("exp_"+
c,"expandInActive"),b.contains("rec_"+c,"recDefault")&&b.remove("rec_"+c,"recDefault")):(b.contains("recIcon_"+c,"active")&&b.remove("recIcon_"+c,"active"),this.config.countEnabled&&b.contains("recNum_"+c,"recNum")&&(b.remove("recNum_"+c,"recNum"),b.add("recNum_"+c,"recNumInActive")),r&&r.firstChild&&b.add(r.firstChild,"inActive"),e.listDisabled||(b.contains("exp_"+c,"expandInActive")||b.add("exp_"+c,"expandInActive"),e.toggleLegend.remove()),b.contains("rec_"+c,"rec")&&b.add("rec_"+c,"recDefault"))}},
enableRefresh:function(){var a=null,c=!1,e;for(e in this.layerList){var b,a=this.layerList[e];a.li&&(b=a.li.itemId);if("ClusterLayer"!==a.type)a=a.layerObject;else for(var r=0;r<this.layerInfos.length;r++){var d=this.layerInfos[r];if(d.layerObject){a=d.layerObject;break}}!c&&b&&(this.getItem(b),c=!0);a&&(a.refreshInterval=this.config.refreshInterval)}a=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=a,this.refreshInterval=setInterval(l.hitch(this,
this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==a&&(this.refreshIntervalValue=a,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(l.hitch(this,this.refreshLayers),this.refreshIntervalValue))},getItem:function(a){var c=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+a;ca({url:c,content:{f:"json",requestTime:Date.now()}}).then(l.hitch(this,function(e){if(e){e=
e.modified;var b=!0;this.lastModifiedTime&&(b=this.lastModifiedTime<e);-1<this.currentQueryList.indexOf(a)&&this.currentQueryList.splice(this.currentQueryList.indexOf(a),1);b&&(this.lastModifiedTime=e,this._updatePanelTime(e),ca({url:c+"/data",content:{f:"json",requestTime:Date.now()}}).then(l.hitch(this,this._updateItem,a)))}}))},_updatePanelTime:function(a){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=x.fieldFormatter.getFormattedDate(new Date(a),
{dateFormat:"shortDateShortTime"}))},refreshLayers:function(){for(var a in this.layerList){var c=this.layerList[a],e;c.li&&c.li.itemId?e=c.li.itemId:c.layerObject.itemId&&(e=c.layerObject.itemId);e&&-1===this.currentQueryList.indexOf(e)&&(this.currentQueryList.push(e),this.getItem(e))}},_updateItem:function(a,c){for(var e=0;e<c.layers.length;e++)this._updateLayerItem(c.layers[e],this.lastModifiedTime);this.currentQueryList.splice(this.currentQueryList.indexOf(a),1)},_updateLayerItem:function(a){var c,
e,b,d,k;for(k in this.layerList){var g=this.layerList[k];if(g.pl&&g.pl.layerDefinition){if(g.pl.layerDefinition.name===a.layerDefinition.name){c=g;e=g.pl;break}}else if(g.layerObject._parentLayer)g.layerObject._parentLayer.name===a.layerDefinition.name&&(b="undefined"!==typeof g.listDisabled?g.listDisabled:!1,d=g.li.symbolData.featureDisplayOptions.fields&&0<g.li.symbolData.featureDisplayOptions.fields.length,!b&&d&&(g.isLoaded=!1),g.layerObject.refreshFeatures(a),g.layerObject&&this._loadList(g,
!0));else if(g.pl&&g.pl.name&&g.pl.name===a.layerDefinition.name){c=g;e=g.pl;break}}if(a&&c&&e&&(e.featureSet||e.graphics)){k=a.featureSet.features;var q;if(e.featureSet)q=e.featureSet.features;else{q=[];var h=this._getSpatialReference(k),f=this._getSpatialReference(e.graphics);F.forEach(e.graphics,function(a){var c=a.geometry,c=c.rings?{rings:c.rings}:c.paths?{paths:c.paths}:c.points?{points:c.points}:c.x&&c.y?{x:c.x,y:c.y}:{};c!=={}&&q.push({attributes:a.attributes,geometry:l.mixin({spatialReference:h&&
f&&h.wkid===f.wkid?h:f},c)})})}a.featureSet.transform&&(k=(new fa(a.featureSet)).features);a=!0;1E4>k.length&&(a=JSON.stringify(q)!==JSON.stringify(k));if(a){b="undefined"!==typeof c.listDisabled?c.listDisabled:!1;d=c.li.symbolData.featureDisplayOptions.fields&&0<c.li.symbolData.featureDisplayOptions.fields.length;!b&&d&&(c.isLoaded=!1,c.requiresReload=!0);b&&(c.li.layerListExtentChanged=!0);c.layerObject.clear();a=c.layerObject.spatialReference;for(b=0;b<k.length;b++)d=k[b],d.geometry?(g=this.getGraphicOptions(d,
a),g=new w(g),g.setAttributes(d.attributes),this._infoTemplate&&g.setInfoTemplate(this._infoTemplate),c.layerObject.add(g)):console.log("Null geometry skipped");c.layerObject.refresh();e.featureSet&&(e.featureSet.features=k);this.countFeatures(c).then(l.hitch(this,function(a){a.layerObject&&a.layerObject.visible&&this._loadList(a,!0)}))}}},_getSpatialReference:function(a){var c;a&&a.hasOwnProperty("length")&&0<a.length&&(a=a[0],a.geometry&&a.geometry.spatialReference&&(c=a.geometry.spatialReference));
return c},getGraphicOptions:function(a,c){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:c.wkid}}}:"undefined"!==typeof a.geometry.points?{geometry:{points:a.geometry.points,spatialReference:{wkid:c.wkid}}}:{geometry:new Z(a.geometry.x,a.geometry.y,a.geometry.spatialReference)}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?
this.config.hidePanel:!1;this.showAllFeatures="undefined"!==typeof this.config.showAllFeatures?this.config.showAllFeatures:!1;this.map.itemId&&D.getInstance(this.map,this.map.itemInfo).then(l.hitch(this,function(a){this.wmLayerInfos=a.getLayerInfoArrayOfWebmap();this.layerInfos=a.getLayerInfoArray();this.operLayerInfos=a;this._updateLayerIDs();this.config.upgradeFields&&this._upgradeFields();this._createPanelUI(this.configLayerInfos,a);this._addFilterChanged(a);this._addVisibleChanged(a);this._addZoomChanged(a)}))},
_updateLayerIDs:function(){var a=[],c=0;for(;c<this.configLayerInfos.length;c++){var e=this.configLayerInfos[c],b=this.operLayerInfos.getLayerInfoById(e.id);if(b)e.url=b.layerObject&&b.layerObject.url?b.layerObject.url:e.url;else{var d=!1,k=0;b:for(;k<this.wmLayerInfos.length;k++){var g=this.wmLayerInfos[k],q=g?g.originOperLayer:void 0,h=this._compareURL(q,e),q=this._compareItemID(q,e),g=this._compareSubId(g,e);if(b=(h=h?h:q?q:g?g:void 0)?this.operLayerInfos.getLayerInfoById(h):b){this.configLayerInfos[c].id=
b.id;this.configLayerInfos[c].layer=b.id;this.configLayerInfos[c].url=b.layerObject&&b.layerObject.url?b.layerObject.url:this.configLayerInfos[c].url;d=!0;break b}}d||b||a.push(c)}}0<a.length&&(a.sort(function(a,c){return c-a}),F.forEach(a,l.hitch(this,function(a){this.configLayerInfos.splice(a,1)})))},_compareSubId:function(a,c){if(a&&a.subId&&-1<a.subId.indexOf(c.id)&&a.layerObject){var e=this._compareGeom(a.layerObject,c);c=this._compareFields(a.layerObject,c);if(e&&c)return a.subId}},_compareItemID:function(a,
c){if(a&&a.itemId&&a.itemId===c.itemId)if(a.featureCollection&&a.featureCollection.layers&&a.featureCollection.layers.hasOwnProperty("length")){a=a.featureCollection.layers;for(var e=0;e<a.length;e++){var b=a[e];if(this._compareGeom(b,c)&&this._compareFields(b,c))return b.id}}else console.log("error in checking item by itemID")},_compareURL:function(a,c){return a&&a.url&&c.url&&a.url===c.url?a.id:void 0},_compareGeom:function(a,c){return a&&a.geometryType&&c.geometryType?a.geometryType===c.geometryType:
void 0},_compareFields:function(a,c){var e;a&&a.fields&&c.fields&&a.fields.length===c.fields.length&&(e=a.fields.filter(function(a){for(var e=0;e<c.fields.length;e++)if(a.name===c.fields[e].name)return a}).length===a.fields.length);return e},_upgradeFields:function(){if(this.configLayerInfos)for(var a=0;a<this.configLayerInfos.length;a++){var c=this.configLayerInfos[a];if(c&&c.symbolData&&c.symbolData.featureDisplayOptions){var e=this.operLayerInfos.getLayerInfoById(c.id);if(e){var b=c.symbolData.featureDisplayOptions.fields;
if("undefined"===typeof b||b.hasOwnProperty("length")&&0===b.length){var d=e&&e.layerObject?e.layerObject:void 0,b=d&&d.objectIdField?d.objectIdField:void 0,k="",g="";if((d=c.fields?c.fields:d?d.fields:void 0)&&0<d.length){var q=0;a:for(;q<d.length;q++){var h=d[q];""===k&&"esriFieldTypeOID"!==h.type&&"esriFieldTypeGeometry"!==h.type&&h.name!==b&&(k=h.name,g=h.alias||h.name);b||(b="esriFieldTypeOID"===h.type?h.name:b);if(b&&""!==k)break a}}q=d="";c=c.infoTemplate&&c.infoTemplate.info&&c.infoTemplate.info.fieldInfos?
c.infoTemplate:e?e.getInfoTemplate():void 0;if(!c)a:for(e=e.getSubLayers(),h=0;h<e.length;h++){var f=e[h];if(f.title&&f.layerObject&&f.layerObject.name&&f.title===f.layerObject.name){c=f.getInfoTemplate?f.getInfoTemplate():c;break a}}e=c?c.info.fieldInfos:[];c=0;a:for(;c<e.length;c++)if((h=e[c])&&h.visible&&(!b||b!==h.fieldName)){d=h.fieldName;q=h.label||h.fieldName;break a}this.configLayerInfos[a].symbolData.featureDisplayOptions.fields=[{name:d?d:k,label:d?q:g}]}}}}},_addFilterChanged:function(a){2.1<=
parseFloat(this.appConfig.wabVersion)&&this.own(a.on("layerInfosFilterChanged",l.hitch(this,function(a){F.forEach(a,l.hitch(this,function(a){var c=a.id,b=a.id+this.UNIQUE_APPEND_VAL_CL;a=a.getFilter();this.layerList.hasOwnProperty(c)?(this.layerList[c].isLoaded=this.layerList[c].filter===a,this.layerList[c].filter=a,this._loadList(this.layerList[c],!0)):this.layerList.hasOwnProperty(b)&&(this.layerList[b].layerObject.filter=a,this.layerList[b].layerObject._initFeatures())}))})))},_updateVisibility:function(a){if(a){var c=
a.id,b=a.isShowInMap();if(this.layerList.hasOwnProperty(c)){var d=this.layerList[c];c===d.li.id&&d.visible!==b?this._toggleLayerUI(d.li,b):c===d.id&&d.visible!==b&&this._toggleLayerUI(a,b)}}},_addVisibleChanged:function(a){this.own(a.on("layerInfosIsVisibleChanged",l.hitch(this,function(a){F.forEach(a,function(a){this._updateVisibility(a)},this)})))},_addZoomChanged:function(a){this.own(p(this.map,"zoom-end",l.hitch(this,function(){a.traversal(l.hitch(this,function(a){this._updateVisibility(a)}))})))},
_updatePanelHeader:function(){var a;a=this.map.width;this.config.displayPanelIcon&&750<a?(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeaderNoIcon"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?g.addClass(this.pageHeader,"pageHeaderRefresh"):g.addClass(this.pageHeader,"pageHeaderRefreshNoText"):g.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(g.removeClass(this.pageBody,"pageBodyNoIcon"),g.removeClass(this.pageBody,
"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?g.addClass(this.pageBody,"pageBodyRefresh"):g.addClass(this.pageBody,"pageBodyRefreshNoText"):g.addClass(this.pageBody,"pageBody")),this.pageTitle&&(g.addClass(this.pageTitle,"pageTitleWidth"),this.config.refreshEnabled?(g.removeClass(this.pageTitle,"pageTitle"),g.removeClass(this.pageTitle,"pageTitleRefresh-tab"),g.removeClass(this.pageTitle,"pageTitleRefresh"),g.addClass(this.pageTitle,this.useDarkText?"pageTitleRefresh-tab":
"pageTitleRefresh")):(g.removeClass(this.pageTitle,"pageTitleRefresh"),g.removeClass(this.pageTitle,"pageTitleRefresh-tab"),g.addClass(this.pageTitle,"pageTitle"))),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):this.config.displayPanelIcon||this.config.refreshEnabled?!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeader"),g.removeClass(this.pageHeader,
"pageHeaderNoIcon"),g.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(g.removeClass(this.pageBody,"pageBody"),g.removeClass(this.pageBody,"pageBodyNoIcon"),g.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&g.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&750>=a&&this.config.refreshEnabled&&(this.pageHeader&&(g.removeClass(this.pageHeader,
"pageHeaderNoIcon"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),g.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?g.addClass(this.pageHeader,"pageHeaderRefresh"):g.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&(g.removeClass(this.pageBody,"pageBodyNoIcon"),g.removeClass(this.pageBody,"pageBodyNoIconRefresh"),g.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?g.addClass(this.pageBody,"pageBodyRefresh"):g.addClass(this.pageBody,
"pageBodyRefreshNoText")),this.pageTitle&&g.addClass(this.pageTitle,"pageTitleWidth"),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a):(this.pageHeader&&(g.removeClass(this.pageHeader,"pageHeader"),g.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),g.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(g.removeClass(this.pageBody,"pageBody"),g.removeClass(this.pageBody,"pageBodyNoIconRefresh"),g.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e")},_createPanelUI:function(a,c){this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var b=0;b<a.length;b++){var d=a[b];"ThemeCluster"===d.symbolData.clusterType&&this.updateThemeClusterSymbol(d,b);var g=c.getLayerInfoById(d.id);g&&function(a,c){c.getLayerType().then(l.hitch(this,function(b){(function(a,c,b){c.getLayerObject().then(l.hitch(this,
function(e){this.updateLayerList(e,a,b,c)}))}).call(this,a,c,b)}))}.call(this,d,g)}if(!this.hidePanel)for(var k in this.layerList)a=this.layerList[k],"ClusterLayer"!==a.type&&a&&a.layerObject&&a.layerObject.hasOwnProperty("refreshInterval")&&0<a.layerObject.refreshInterval&&this.updateEnd.push(this.own(p(a.layerObject,"update-end",l.hitch(this,this._updateEnd))));this.addMapLayers()},_updateEnd:function(a){var c=this.layerList.hasOwnProperty(a.target.id)?a.target.id:this.layerList.hasOwnProperty(a.target.id+
"_CL")?a.target.id+"_CL":"";if(""===c)for(var b in this.layerList){var d=this.layerList[b];if(d&&d.layerObject&&d.layerObject.id===a.target.id){c=d.li.id;break}}this.layerList.hasOwnProperty(c)&&(a=this.layerList[c],a.isLoaded=!1,a.updating=!1,a.requiresReload=!0,a&&(a.legendOpen?this._loadList(a,this.config.countEnabled):this.config.countEnabled&&this.countFeatures(a)))},updateThemeClusterSymbol:function(a,c){a=a.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===
typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var b=C.fromHex(this._styleColor);c+=1;var d=0<c?30*c:30,g=0===c%2,k=b.g,h=b.b,b=b.r-d;g&&(255<b?b-=255:0>b&&(b+=255));h-=d;0===c%3&&g&&(255<h?h-=255:0>h&&(h+=255));d=k-d;0===c%5&&g&&(255<d?d-=255:0>d&&(d+=255));a.clusterType="CustomCluster";a.clusterSymbol={color:[b,d,h,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},removeOldClusterLayers:function(a){var c=
[],b;for(b in this.layerList)if("ClusterLayer"===this.layerList[b].type){var d=0;a:for(;d<a.length;d++){var g=a[d];if(g.id+this.UNIQUE_APPEND_VAL_CL===b){g.symbolData&&!g.symbolData.clusteringEnabled&&c.push(b);break a}}}if(0<c.length)for(var k in c)if(this.layerList.hasOwnProperty(c[k])){if(-1<this.map.graphicsLayerIds.indexOf(c[k])){if((a=this.layerList[c[k]])&&a.li){var h;a.li.parentLayerID&&(h=this.operLayerInfos.getLayerInfoById(a.li.parentLayerID));!h&&a.li.layer&&(h=this.operLayerInfos.getLayerInfoById(a.li.layer));
h&&a.hasOwnProperty("parentLayerVisible")&&h.setTopLayerVisible(a.parentLayerVisible)}this.map.removeLayer(this.layerList[c[k]].layerObject)}this.layerList[c[k]].layerObject.destroy();delete this.layerList[c[k]]}},addMapLayers:function(){for(var a=Object.keys(this.layerList).reverse(),c=0;c<a.length;c++){var b=a[c],d=this.layerList[b];d.type&&"ClusterLayer"===d.type&&-1===this.map.graphicsLayerIds.indexOf(b)&&this.map.addLayer(d.layerObject)}},updateLayerList:function(a,c,b,d){var e,k=null,g,h,t;
d=d||this.operLayerInfos.getLayerInfoById(a.id);var f=this._checkSelfType(d,c,b,a),m=this._checkListDisabled(c),n=x.getFeatureLayerDefinition(a);if(c.symbolData.clusteringEnabled)e=this._getClusterLayer(c,a,d,b),g="ClusterLayer",b=e,h=e.id,this.hidePanel||this.own(p(e,"update-end",l.hitch(this,function(){this._loadList(this.layerList[e.id],!0)}))),this.numClusterLayers+=1;else if("ArcGISStreamLayer"===a.layerType)g="StreamLayer",h=a.layerObject.id,b=a.layerObject,t=a;else{h="FeatureLayer"===b?c.id:
a.id;var P=this.operLayerInfos.getLayerInfoById(c.parentLayerID)||a.parentLayerInfo;if(P&&P.layerObject&&(k=P.layerObject,g=k.type,P.originOperLayer&&P.originOperLayer.featureCollection&&(g=P.originOperLayer.featureCollection.layers)))for(P=0;P<g.length;P++){var Y=g[P];Y.id===h&&(t=Y)}e=a.layerObject?a.layerObject:a;g=b;b=k&&!k.empty?k:e?e:a;if("geo_rss"===f&&b&&b.getFeatureLayers)for(P=b.getFeatureLayers(),Y=0;Y<P.length;Y++){var u=P[Y];u.id===c.id&&(b=u)}t=t?t:a}this.layerList[h]={type:g,layerObject:b,
pl:t,id:h,visible:d&&d.isShowInMap?d.isShowInMap():!0,li:c,filter:d?d.getFilter():"1\x3d1",infoTemplate:d.getInfoTemplate()||c.infoTemplate,selfType:f,listDisabled:m,showAllFeatures:this.showAllFeatures,layerDefinition:n};"ArcGISStreamLayer"!==a.layerType&&this.updateRenderer(h);this.hidePanel||this._addPanelItem(k?k:e?e:a,c,m,d)},_checkListDisabled:function(a){return a.symbolData.featureDisplayOptions.listDisabled?a.symbolData.featureDisplayOptions.listDisabled:a.symbolData.featureDisplayOptions.fields?
0===a.symbolData.featureDisplayOptions.fields.length:!0},_checkSelfType:function(a,c,b,d){d=(c=c.layerObject&&!c.layerObject.empty?c.layerObject:d)&&c.originOperLayer?c.originOperLayer:d;a=(a=a.originOperLayer&&a.originOperLayer.selfType?a.originOperLayer.selfType:d&&d.selfType?d.selfType:"")&&""!==a?a:d&&d.layerType&&"CSV"===d.layerType?"collection":"Feature Collection"===b?"collection":"";!a&&b&&"KML"===b&&(a="kml");return a},updateRenderer:function(a){a=this.layerList[a];if("LayerSymbol"!==a.li.symbolData.symbolType){"undefined"===
typeof a.li.orgRenderer&&(a.li.orgRenderer=a.layerObject.renderer?a.layerObject.renderer:a.li.renderer);var c=new ga(X.fromJson(a.li.symbolData.symbol));a.li.newRenderer=c;if(a.layerObject.setRenderer)a.layerObject.setRenderer(c);else if(a.layerObject.setLayerDrawingOptions){var b=[],d=new ea;d.renderer=c;b[a.li.subLayerId]=d;a.layerObject.setLayerDrawingOptions(b)}else console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof a.layerObject.refresh&&
a.layerObject.refresh()}},_onRecNodeMouseover:function(a){b.add(a,this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},_onRecNodeMouseout:function(a){b.remove(a,this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},_addPanelItem:function(a,c,b,d){var e=c.id+this.UNIQUE_APPEND_VAL_CL,e=c.id in this.layerList?c.id:e in this.layerList?
e:"",k=this.layerList[e];if(k){var h=k.type,q;q=this.isDashboardTheme?["rec","expand","expandDown-dashboard","solidBorder"]:this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:["rec","expand","expandDown","solidBorder"];var f=m.create("div",{"class":q[0]+" "+q[3],id:"rec_"+e},this.pageMain);b?(g.setStyle(f,"cursor","default"),q="expand-empty"):(this.own(p(f,"mouseover",l.hitch(this,this._onRecNodeMouseover,f))),this.own(p(f,"mouseout",l.hitch(this,this._onRecNodeMouseout,
f))),q=q[1]+" "+q[2],d&&d.isInScale&&(q+=d.isInScale()?"":" expandInActive"));m.create("div",{"class":q,id:"exp_"+e},f);d=m.create("div",{"class":"recIcon active",id:"recIcon_"+e},f);c.panelImageData&&-1<c.panelImageData.toString().indexOf("\x3cimg")&&(q=document.createElement("div"),q.innerHTML=c.panelImageData,q=new V(q.children[0].src,26,26),c.panelImageData=this._createImageDataDiv(q,44,44,void 0,!0).innerHTML);d.innerHTML=c.panelImageData;T.set(d.firstChild,"border-radius","41px");var t;this.config.countEnabled?
(c=m.create("div",{"class":"recLabel",id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+c.label+"\x3c/p\x3e"},f),g.setStyle(c,"top","20px"),t=m.create("div",{"class":"recNum",id:"recNum_"+e,innerHTML:""},f)):c=m.create("div",{"class":"recLabelNoCount",id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+c.label+"\x3c/p\x3e"},f);"ClusterLayer"===h?(a.node=t,b||this._addLegend(e,k),a._updateNode(a.nodeCount)):"StreamLayer"===h?(k.node=t,this.countFeatures(k),b||this._addLegend(e,k)):(k.node=t,this._addLegend(e,k));p(d,"click",
l.hitch(this,this._toggleLayerVisibility,k));b||(k.toggleLegend=p(f,"click",l.hitch(this,this._toggleLegend,k)))}},_addLegend:function(a,c){c.legendOpen=null===this.row&&this.config.expandList;c.legendNode=m.create("div",{"class":"legendLayer "+(c.legendOpen?"legendOn":"legendOff"),id:"legend_"+a},this.pageMain);"ClusterLayer"===c.type&&(c.layerObject.legendNode=c.legendNode);this.row="firstRowExpanded"},_getListFields:function(a){var c=[],b=this._getInfoTemplate(a);F.forEach(b&&b.info&&b.info.fieldInfos?
b.info.fieldInfos:[],function(a){a.visible&&c.push(a.fieldName)});var d=a.li.symbolData&&a.li.symbolData.featureDisplayOptions?a.li.symbolData.featureDisplayOptions:{};F.forEach(d.fields||[],function(a){-1===c.indexOf(a.name)&&c.push(a.name)});d.groupField&&-1===c.indexOf(d.groupField.name)&&c.push(d.groupField.name);if(0===c.length||"undefined"===typeof b)c=["*"];"*"!==c[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===c.indexOf(a.layerObject.objectIdField)&&c.push(a.layerObject.objectIdField);
return c},_loadList:function(a,c){if(!this.hidePanel){var e=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;c&&this._addSearching(e);var d=this._getListFields(a);if("ClusterLayer"===a.type){a.li.layerListExtentChanged&&(a.layerObject.clusterFeatures(),a.li.layerListExtentChanged=!1);var g=[];if(a.layerObject.clusterGraphics||a.layerObject._features){if(this.showAllFeatures)g=a.layerObject._features;else for(var e=a.layerObject.clusterGraphics,k=0;k<e.length;k++){var h=e[k];if(h.graphics&&
0<h.graphics.length)for(var f=0;f<h.graphics.length;f++)g.push(h.graphics[f])}setTimeout(l.hitch(this,function(){this._updateList(g,a.legendNode,a.layerObject.node,d,c,a)}),100)}else this._removeSearching(e,a.legendNode?!b.contains(a.legendNode,"legendOff"):!0)}else this.getFeatures(a,d,c)}},_addSearching:function(a){var c=this.layerList[a].listDisabled,e=c?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",d=c?"expand-empty":
this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp",c=c?"expandSearching-empty":"expandSearching";b.contains("exp_"+a,e)&&(b.remove("exp_"+a,e),b.add("exp_"+a,c));b.contains("exp_"+a,d)&&(b.remove("exp_"+a,d),b.add("exp_"+a,c))},_removeSearching:function(a,c){var e=this.layerList[a].listDisabled,d=e?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",g=e?"expand-empty":
this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp",e=e?"expandSearching-empty":"expandSearching";b.contains("exp_"+a,e)&&(b.remove("exp_"+a,e),b.add("exp_"+a,c?g:d))},_getClusterLayer:function(a,c,b,d){var e=c.layerObject?c.layerObject:c,g=a.infoTemplate,h=e&&e.originOperLayer?e.originOperLayer:c.parentLayerInfo?c.parentLayerInfo:b?b.originOperLayer:void 0,f=null,f=a.id+this.UNIQUE_APPEND_VAL_CL;c=!0;-1<this.map.graphicsLayerIds.indexOf(f)||
-1<this.map._layers.indexOf(f)?(f=this.map.getLayer(f),g=e=!1,JSON.stringify(f.symbolData)!==JSON.stringify(a.symbolData)&&(f.symbolData=a.symbolData,f.countColor=a.symbolData._highLightColor,g=!0),d=m.toDom(a.panelImageData),JSON.stringify(f.icon)!==JSON.stringify(d.src)&&(f.icon=d.src,g=!0),m.destroy(d.id),f.displayFeatureCount=a.symbolData.displayFeatureCount,f.refresh!==a.refresh&&(f.refresh=a.refresh,e=!0),g&&f._setupSymbols(),f.countEnabled=this.config.countEnabled,f.hidePanel=this.hidePanel,
f.showAllFeatures!==this.showAllFeatures&&(e=!0,f.showAllFeatures=this.showAllFeatures),f.listDisabled!==this.listDisabled&&(e=!0,f.listDisabled=this.listDisabled),e?f.url&&f.refreshFeatures(f.url):g&&f.clusterFeatures()):(c=!1,f=new v({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:f,map:this.map,node:n.byId("recNum_"+f),legendNode:n.byId("legend_"+f),infoTemplate:"undefined"!==typeof e.infoTemplate?e.infoTemplate:g,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,
parentLayer:e,lyrInfo:a,lyrType:d,_styleColor:this._styleColor,originOperLayer:h,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:b?b.getFilter():"1\x3d1",showAllFeatures:this.showAllFeatures,listDisabled:this.listDisabled}));f.setVisibility(c?f.visible:b.isShowInMap?b.isShowInMap():!0);return f},_createImageDataDiv:function(a,c,b,g,h){var e;if(a){e=c;var f=b;if(a.height&&a.width){var t;if(a.height>a.width)t=a.width/a.height,f=c*t;else if(a.width===a.height||a.width>a.height)f=
c,t=a.width/a.height,e=0<t?b*t:b}"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(h?f-.25*f:f),a.setHeight(h?e-.25*e:e)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);e=m.create("div",{"class":"imageDataGFX"},g);g=d.createSurface(e,c,b);a=X.getShapeDescriptors(a);g.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:c/2,dy:b/2})}return e},_updateUI:function(a){this.styleName=a;this.isDashboardTheme&&(this.isLightTheme=
a?"light"===a:this.isLightTheme,this._updateNodes(this.isLightTheme?"expandDown-dashboard":"expandDown",this.isLightTheme?"expandDown":"expandDown-dashboard"),this._updateNodes(this.isLightTheme?"expandUp-dashboard":"expandUp",this.isLightTheme?"expandUp":"expandUp-dashboard"),this._updateNodes(this.isLightTheme?"expand-dashboard":"expand",this.isLightTheme?"expand":"expand-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",this.isLightTheme?"groupItemImageUp":
"groupItemImageUp-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",this.isLightTheme?"groupItemImageDown":"groupItemImageDown-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",this.isLightTheme?"groupItemImage":"groupItemImage-dashboard"))},_updateNodes:function(a,c){var e=E("."+a);F.forEach(e,function(e){b.remove(e,a);b.add(e,c)})},_toggleLayerVisibility:function(a,c){c.stopPropagation();this.map.infoWindow.hide();
c=a.id?a.id:a.layerObject.id;var e=this.layerList[c];e||(a.pl&&(c=a.pl.id),e=this.layerList[c]);if(e){var d=e.li&&e.li.hasOwnProperty("subLayerId")?"undefined"!==typeof e.li.subLayerId&&"-1"!==e.li.subLayerId.toString():!1;a=this.operLayerInfos.getLayerInfoById(c);var g=!b.contains("recIcon_"+c,"active");if(d&&"ClusterLayer"!==e.type){if(g)for(c=a.parentLayerInfo;c;)c.setTopLayerVisible(!0),c=c.parentLayerInfo;a.setTopLayerVisible(g)}else e&&(e.layerObject.setVisibility(g),"ClusterLayer"===e.type&&
g&&(e.layerObject.handleMapExtentChange({levelChange:!0}),e.layerObject.flashFeatures()),"undefined"!==typeof e.pl&&(e.pl.visibility=g,-1<this.map.graphicsLayerIds.indexOf(c)&&this.map.getLayer(c).setVisibility(g)))}},_toggleLayerUI:function(a,c){var e=a.id?a.id:a.layerObject.id,d=this.layerList[e];d||(a.pl&&(e=a.pl.id),d=this.layerList[e]);if(d){a=this.operLayerInfos.getLayerInfoById(e);a=a.isCurrentScaleInTheScaleRange?a.isCurrentScaleInTheScaleRange():!0;var g=n.byId("recLabel_"+e);this.layerList[e].visible=
c;this.layerList[e].parentLayerVisible=c;"ClusterLayer"===this.layerList[e].type&&(this.layerList[e].layerObject.parentLayerVisible=c);if(this.config.countEnabled&&b.contains("recNum_"+e,c?"recNumInActive":"recNum")){var f=this.isDartTheme?" darkThemeColor":" lightThemeColor";b.remove("recNum_"+e,c?"recNumInActive":"recNum");b.add("recNum_"+e,(c?"recNum":"recNumInActive")+f)}var f=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",h=this.isDartTheme?
"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp";if(c){b.add("recIcon_"+e,"active");g&&g.firstChild&&b.remove(g.firstChild,"inActive");b.contains("exp_"+e,"expandInActive")&&a&&b.remove("exp_"+e,"expandInActive");d.toggleLegend&&d.toggleLegend.remove();if(c=n.byId("rec_"+e))d.toggleLegend=p(c,"click",l.hitch(this,this._toggleLegend,d));b.contains("rec_"+e,"recDefault")&&b.remove("rec_"+e,"recDefault");d.listDisabled||(this._loadList(d,!0),d.legendOpen&&(b.add("legend_"+
e,"legendOn"),b.remove("legend_"+e,"legendOff"),b.contains("exp_"+e,f)&&(b.remove("exp_"+e,f),b.add("exp_"+e,h))))}else b.remove("recIcon_"+e,"active"),g&&g.firstChild&&b.add(g.firstChild,"inActive"),b.contains("exp_"+e,"expandInActive")||b.add("exp_"+e,"expandInActive"),d.legendOpen&&b.contains("legend_"+e,"legendOn")&&(b.remove("legend_"+e,"legendOn"),b.add("legend_"+e,"legendOff"),b.contains("exp_"+e,h)&&(b.remove("exp_"+e,h),b.add("exp_"+e,f))),d.toggleLegend&&d.toggleLegend.remove(),b.contains("rec_"+
e,"rec")&&b.add("rec_"+e,"recDefault")}return!1},_toggleLegend:function(a,c){if("thumb2"!==c.currentTarget.className&&"recIcon"!==c.currentTarget.className){var e=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;if(b.contains("legend_"+e,"legendOff")){this._addSearching(e);this.layerList[e].legendOpen=!0;if("undefined"===typeof this.layerList[e].li.layerListExtentChanged||this.layerList[e].requiresReload)this.layerList[e].li.layerListExtentChanged=!0,this.layerList[e].requiresReload=!1;
this.layerList[e].li.layerListExtentChanged?setTimeout(l.hitch(this,function(){this._loadList(a,!1)}),500):this._removeSearching(e,!0);b.remove("legend_"+e,"legendOff");b.add("legend_"+e,"legendOn")}else if(b.contains("legend_"+e,"legendOn")){this.layerList[e].legendOpen=!1;var d=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",g=this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp";
b.contains("exp_"+e,g)&&(b.remove("exp_"+e,g),b.add("exp_"+e,d));b.remove("legend_"+e,"legendOn");b.add("legend_"+e,"legendOff")}}c.stopPropagation()},_toggleGroup:function(a,c){var e=c.currentTarget.id.slice(0,-2),d=this.isDartTheme?"featureItem-dart":"featureItem",f=!0;c.target.parentNode&&(""!==c.target.parentNode.id&&b.contains(c.target.parentNode.id,d)&&(f=!1),""!==c.target.id&&b.contains(c.target.id,d)&&(f=!1));var d=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?
"groupItemImage-dashboard":"groupItemImage",h=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",l=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown";if(f){a=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;var f=document.getElementById(c.currentTarget.id),q=f.childNodes[0].childNodes.length-1;b.contains(e,"groupOff")?(this.layerList[a].openGroups&&
0<this.layerList[a].openGroups.length?-1===this.layerList[a].openGroups.indexOf(e)&&this.layerList[a].openGroups.push(e):this.layerList[a].openGroups=[e],b.remove(e,"groupOff"),b.add(e,"groupOn"),this.layerList[a].groupOpen=!0,-1<f.childNodes[0].childNodes[q].childNodes[0].className.indexOf(d)&&(g.removeClass(f.childNodes[0].childNodes[q].childNodes[0],l),g.addClass(f.childNodes[0].childNodes[q].childNodes[0],h))):b.contains(e,"groupOn")&&(b.remove(e,"groupOn"),b.add(e,"groupOff"),this.layerList[a].openGroups&&
0<this.layerList[a].openGroups.length?(e=this.layerList[a].openGroups.indexOf(e),-1<e&&this.layerList[a].openGroups.splice(e,1),0===this.layerList[a].openGroups.length&&(this.layerList[a].groupOpen=!1)):this.layerList[a].groupOpen=!1,-1<f.childNodes[0].childNodes[q].childNodes[0].className.indexOf(d)&&(g.removeClass(f.childNodes[0].childNodes[q].childNodes[0],h),g.addClass(c.currentTarget.childNodes[0].childNodes[q].childNodes[0],l)))}},onAppConfigChanged:function(a,c,b){switch(c){case "themeChange":this.inPanelOverrides(b);
this.destroy();break;case "layoutChange":this.inPanelOverrides(b);break;case "styleChange":this.hidePanel||(this._updateUI(b),this._updateStyleColor(b));break;case "widgetChange":this.widgetChange=!0;b&&b.config&&b.config.layerInfos&&this.removeOldClusterLayers(b.config.layerInfos);this.row=null;break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(l.hitch(this,function(){var c=this.getPanel();switch(this.appConfig.theme.name){case "BoxTheme":c=c.containerNode.parentNode.parentNode.children[0];
break;case "DartTheme":c=c.containerNode.parentNode;break;case "TabTheme":c=c.containerNode;break;case "BillboardTheme":c=c.containerNode.parentNode;break;case "FoldableTheme":c=c.containerNode.parentNode.firstChild;break;default:c=this.pageHeader}c=window.getComputedStyle(c,null).getPropertyValue("background-color");if("transparent"===c||-1!==[null,void 0].indexOf(W.fromRgb(c).toHex()))c="rgba(0, 0, 0, 0)";this._styleColor=W.fromRgb(c).toHex();for(var b in this.layerList)c=this.layerList[b],"ClusterLayer"===
c.type&&c.layerObject.setStyleColor(this._styleColor);this._updateUI(a)}),50)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var c=this.layerList[a];if("ClusterLayer"===c.type){var b=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(b=!this.continuousRefreshEnabled);b&&(c.layerObject._clear(),this.map.removeLayer(c.layerObject))}}this.layerList={}}},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);for(var a in this.layerList){var c=
this.layerList[a];c.li&&c.li.orgRenderer&&(c.layerObject.setRenderer?c.layerObject.setRenderer(c.li.orgRenderer):c.layerObject.setLayerDrawingOptions?c.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),c.layerObject.refresh())}a=!0;"undefined"!==typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.hidePanel||
("undefined"!==typeof this.mapExtentChangedHandler?(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0):"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0))},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},_inVisibleRange:function(a,c){var b=!0;a.layerObject&&a.layerObject.hasOwnProperty("visibleAtMapScale")&&(b=a.layerObject.visibleAtMapScale);(a=this.operLayerInfos.getLayerInfoById(c))&&
a.isCurrentScaleInTheScaleRange&&(b=a.isCurrentScaleInTheScaleRange());return b},_mapExtentChange:function(){for(var a in this.layerList){var c=this.layerList[a];c.visScaleRange=this._inVisibleRange(c,a);this.showAllFeatures||this._clearList(c);!c.legendOpen||c.groupEnabled&&!c.groupOpen?(c.li&&(c.li.layerListExtentChanged=!0),c.visible&&c.visScaleRange?("ClusterLayer"===c.type&&c.layerObject.initalLoad&&this.config.countEnabled&&c.layerObject._updateNode(c.layerObject.node.innerHTML),"ClusterLayer"!==
c.type&&("undefined"===typeof c.layerObject?console.log("layer object not known"):this.countFeatures(c))):c.visScaleRange||this._updateList([],c.legendNode,c.node,[],!0,c)):c.visible&&c.visScaleRange?(c.updateList=!0,this._loadList(c,c.updateList)):this._updateList([],c.legendNode,c.node,[],!0,c)}},getFeatures:function(a,c,b){var e=a.layerObject,d=a.legendNode,g=a.node,f=!a.listDisabled&&a.legendOpen?!0:!1,q=a.visScaleRange,m=e&&e.maxRecordCount?e.maxRecordCount:void 0,p,n=[],u=this._getQuery(a,c,
f);if(a.visible&&q)if(e.queryFeatures)a.listDisabled||n.push(e.queryFeatures(u)),n.push(e.queryIds(u));else{if(p=a.li.url,-1<p.indexOf("MapServer")||-1<p.indexOf("FeatureServer"))q=new h(p),a.listDisabled||n.push(q.execute(u)),n.push(q.executeForIds(u))}else this._updateList([],a.legendNode,a.node,[],!0,a);0<n.length&&J(n).then(l.hitch(this,function(h){var k=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,q;g&&(q=this.config.countEnabled?g.parentNode:g.previousSibling);h&&1<h.length?(k=
h[1])&&m&&k.length>m?this._chunkRequest(e,p,k,m,c,f).then(l.hitch(this,function(e){this._updateList(e,d,g,c,b,a)})):this._updateList(h[0].features,d,g,c,b,a):h&&1===h.length?(this.config.countEnabled&&(g.innerHTML=x.localizeNumber(h[0].length)),this._removeSearching(k,!1)):(this.config.countEnabled&&(g.innerHTML=x.localizeNumber(0)),this.updateExpand(q,!0),this._removeSearching(k,a.legendOpen))}))},_chunkRequest:function(a,c,b,d,g,f){var e=new A,k=[],m,t;m=0;for(t=b.length;m<t;m+=d){var r=b.slice(m,
m+d),p=new aa;p.outFields=g;p.objectIds=r;p.returnGeometry=f;a.queryFeatures?k.push(a.queryFeatures(p)):c&&(r=new h(c),k.push(r.execute(p)))}(new u(k)).then(l.hitch(this,function(a){if(a){for(var c=[],b=0;b<a.length;b++)a[b][1].features&&c.push.apply(c,a[b][1].features);e.resolve(c)}}));return e},_clearList:function(a){!a.isLoaded&&a.legendNode&&(a.isLoaded=!1,a.legendNode.innerHTML="")},_updateList:function(a,c,e,d,g,f,h){var k=f.li?f.li:f;"ClusterLayer"===f.type&&f.layerObject.node&&b.contains(f.layerObject.node.id,
"searching")&&b.remove(f.layerObject.node.id,"searching");var t=f.visScaleRange,r=f.infoTemplate,n=f.symbolData?f.symbolData.featureDisplayOptions:k&&k.symbolData?k.symbolData.featureDisplayOptions:{};if(e||c)c&&(f.hasOwnProperty("isLoaded")?!f.isLoaded:1)&&(c.innerHTML=""),g&&e&&this.config.countEnabled&&(t?e.innerHTML=x.localizeNumber(a.length):function(a,c,b,e){this.countFeatures(f,f.id||k.id).then(function(d){var f=this.config.countEnabled?a.parentNode:c.previousSibling;("ClusterLayer"===d.type&&
d.visible||"ClusterLayer"!==d.type)&&this.updateExpand(f,b?0===e.length:!0)})}.call(this,e,c,t,a)),e=this.config.countEnabled?e.parentNode:c.previousSibling,("ClusterLayer"===f.type&&f.visible||"ClusterLayer"!==f.type)&&this.updateExpand(e,t?0===a.length:!0);if(!h){if(!f.listDisabled&&!f.isLoaded&&0<a.length){h=this.operLayerInfos.getLayerInfoById(f.id);e="ClusterLayer"===f.type?f.layerObject.renderer:h&&h.layerObject&&h.layerObject.renderer?h.layerObject.renderer:a[0]._graphicsLayer?a[0]._graphicsLayer.renderer:
f.layerObject&&f.layerObject.renderer?f.layerObject.renderer:k&&k.renderer?da.fromJson(k.renderer)||k.renderer:f.renderer?da.fromJson(f.renderer)||f.renderer:void 0;g=f.li&&f.li.fields?f.li.fields:f.fields;var u=[],t=[];h=[];for(var v=0;v<a.length;v++){var y=a[v];"undefined"===typeof y.infoTemplate&&r&&(y.infoTemplate=r);var w=e&&e.getSymbol?e.getSymbol(y):y.symbol?X.fromJson(y.symbol):void 0,z=y._layer&&y._layer.objectIdField?y._layer.objectIdField:k&&k.oidFieldName&&k.oidFieldName.name?k.oidFieldName.name:
f.layerObject&&f.layerObject.objectIdField?f.layerObject.objectIdField:f&&f.oidFieldName?f.oidFieldName:void 0,C=z?y.attributes[z]:c.id+v,E=this.getDisplayString(y,f,"*"===d[0]?y.attributes:d,n,z,"*"===d[0]?!1:!0),z=E.displayString,A=E.aliasNames,E=E.firstValue,K,L,I,Q;if(n.groupEnabled){var M,D,J=void 0;if("undefined"===typeof n.groupByField||n.groupByField)K=n.groupField,M=y.attributes[K.name],Q="byField",J=M;else if(K=n.groupByRendererOptions.fields[0],M=y.attributes[K.name],L=n.groupByRendererOptions.values,
Q="byRenderer",null!==M&&""!==M){I=0;a:for(;I<L.length;I++){var N=L[I],B=N.value,B=(B=B.split("\x26\x26"))&&1<B.length?M+B[0]+"\x26\x26 "+M+B[1]:isNaN(M)?"'"+M+"'"+N.value:M+N.value;if(eval(B)){D=N;break a}}"undefined"!==typeof D&&null!==D&&(J=D.label.replace(/ /g,""))}L="group_"+k.id+"_"+K.name+"_"+J;var N=!0,O;if(0<u.length)a:for(I=0;I<u.length;I++)if(B=u[I],L===B.id&&("byField"===Q&&M===B.value||"byRenderer"===Q)){N=!1;O=B.node;I=B.parent;break a}if(N){I=m.create("div",{"class":this.isDartTheme?
"groupItem-dart":"groupItem",id:L+"_c"});var N=m.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:L+"_t"},I),B="",S="byRenderer"===Q?"":K.name+": ";"undefined"!==typeof A&&A.hasOwnProperty(K.name)&&""!==A[K.name]&&(S="byField"===Q?A[K.name]+": ":"");"byField"===Q?"undefined"!==typeof K.label&&""!==K.label&&(S=B=K.label+": "):"undefined"!==typeof D?"undefined"!==typeof D.label&&""!==D.label&&(S=B=S+D.label):S=B=S+M;": "===B&&(S=B="");A=this._getFormattedValue(y,K.name,
f,g);"byRenderer"===Q&&w&&this._createImageDataDiv(l.clone(w),30,30,N,G);m.create("div",{"class":"byField"===Q?"groupField":"groupFieldImage",innerHTML:"byField"===Q?B+A:B,title:"byField"===Q?S+A:S},N);G=!1;f.openGroups&&0<f.openGroups.length&&(G=-1<f.openGroups.indexOf(L));var A=this.isDartTheme?" darkThemeColor":" lightThemeColor",A=m.create("div",{"class":this.isDartTheme?"groupCountLabel":"groupCountLabel"+A},N),N=m.create("div",{"class":this.isDartTheme||this.isDashboardTheme&&!this.isLightTheme?
"expandImageContainer-dart":"expandImageContainer"},N),B=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",S=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",H=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",H=H+(G?" "+B:" "+S);m.create("div",{"class":H},
N);H=this.isDartTheme?"groupItem-dart":"groupItem";H+=f.groupOpen&&G?" groupOn":" groupOff";L=m.create("div",{"class":H,id:L},I);u.push({id:"group_"+k.id+"_"+K.name+"_"+J,node:L,parent:I,value:M});t.push({value:M,node:I,countNode:A,count:1});p(I,"click",l.hitch(this,this._toggleGroup,f))}else t.filter(function(a){if(a.node.id===O.id+"_c")return a})[0].count+=1,L=O}var C=m.create("div",{"class":this.isDartTheme?"featureItem-dart":"featureItem",id:"feature_"+k.id+"_"+C}),G=!1;k&&k.symbolData&&(G="CustomSymbol"===
k.symbolData.symbolType);!w||n.groupEnabled&&"byRenderer"===Q||this._createImageDataDiv(l.clone(w),30,30,C,G);p(C,"click",l.hitch(this,this._panToFeature,y));-1<z.indexOf(" - ")&&(z=z.slice(0,-3));m.create("div",{style:"padding: 7px 5px 5px "+(n.groupEnabled&&"byRenderer"===Q?"15px":"50px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:z,title:z},C);h.push({node:C,updateNode:L?L:c,firstValue:E})}if(0<t.length){a=n.groupByRendererOptions;if(n.groupByRenderer&&a&&a.values){var R=[];F.forEach(a.values,
function(a){R.push(a.label)});n=function(a,c){return R.indexOf(a.node.innerText)-R.indexOf(c.node.innerText)}}else n=function(a,c){return"undefined"===typeof a.value?c.value:"undefined"===typeof c.value?a.value:isNaN(a.value)?a.value.localeCompare(c.value):parseFloat(a.value)-parseFloat(c.value)};var n=t.sort(n),T=this.config.countEnabled;F.forEach(n,function(a){T&&(a.countNode.innerHTML=x.localizeNumber(a.count));c.appendChild(a.node)})}0<h.length&&(n=h.sort(function(a,c){a=a.firstValue;c=c.firstValue;
return"undefined"===typeof a||null===a||""===a?1:"undefined"===typeof c||null===c||""===c?-1:a===c?0:a.toString().localeCompare(c.toString())}),F.forEach(n,function(a){m.place(a.node,a.updateNode)}))}k.layerListExtentChanged=!1;n=f.layerObject&&f.layerObject.id&&f.layerObject.id in this.layerList?f.layerObject.id:k.id;this.showAllFeatures&&f.visible&&(a=!0,f.layerObject&&"ClusterLayer"===f.type&&(a=!f.layerObject.queryPending,f.layerObject.hasOwnProperty("requiresReload")&&(a=a&&!f.layerObject.requiresReload,
f.layerObject.requiresReload=!1)),f.isLoaded=a);this._removeSearching(n,f.legendOpen)}},updateExpand:function(a,c){if("undefined"!==typeof a){var e;-1<a.id.indexOf("rec_")&&(e=a.id.replace("rec_",""),e=n.byId("exp_"+e));c?(a&&(g.addClass(a,"recDefault"),g.addClass(a,"inActive")),e&&(b.contains(e,"expand-empty")||g.addClass(e,"expandInActive"))):(a&&(g.removeClass(a,"recDefault"),g.removeClass(a,"inActive")),e&&(b.contains(e,"expand-empty")||g.removeClass(e,"expandInActive")))}},getDisplayString:function(a,
c,b,d,f,g){var e="",h={},k="";if(0<d.fields.length){var m=c.li&&c.li.fields?c.li.fields:c.fields;F.forEach(d.fields,l.hitch(this,function(d){for(var f in b){var l=g?b[f]:f;if(l===d.name){f=this._getFormattedValue(a,l,c,m);h[l]=this._checkAliasName(m,l);k=""===k?f:k;var t=(l="undefined"!==typeof d.label)?""===d.label.trim()?"":": ":"";e+=(l?d.label:"")+t+f+" - ";break}}}))}return{displayString:e,aliasNames:h,firstValue:k}},_getFormattedValue:function(a,c,b,d){var e=a.attributes[c]||"",f,g=this._getInfoTemplate(b);
g&&(g.info&&g.info.fieldInfos?f=g.info.fieldInfos:g._fieldsMap&&(f=g._fieldsMap));var h;f&&Array.isArray(f)&&f.hasOwnProperty("length")&&(h=this._getFieldByName(f,c));if(d=this._getFieldByName(d,c))f=this._checkIntField(d),g=this._checkDomainField(d),a=this._checkDomainAndSubtype(b.layerDefinition,c,a.attributes),e=this._checkDateField(d)?this.formatDateValue(e,h):g||a?this.formatDomainValue(e,g,a):f?this.formatNumberValue(e,h):e;return e},_getFieldByName:function(a,c){if(a){var b=a.filter(function(b){return b.name===
c||b.fieldName===c||a.hasOwnProperty(b)&&a[b].fieldName===c});if(b&&0<b.length)return b[0]}},_getInfoTemplate:function(a){var c=a.infoTemplate;c||(a.layerObject&&a.layerObject.infoTemplate?c=a.layerObject.infoTemplate:a.li&&a.li.infoTemplate&&(c=a.li.infoTemplate));if(!c&&"undefined"!==typeof a.li.subLayerId){var b=a.layerObject.infoTemplates;b&&b.hasOwnProperty(a.li.subLayerId)&&(c=b[a.li.subLayerId].infoTemplate)}return c},formatNumberValue:function(a,c){var b=a;isNaN(a)||(b=x.localizeNumberByFieldInfo(a,
c&&c.format?c:void 0));return b||""},formatDomainValue:function(a,b,d){if(d)return d;if(b&&b.codedValues)for(b=b.codedValues,d=0;d<b.length;d++){var c=b[d];if(c.code===a)return c.name}},formatDateValue:function(a,b){return a?(b=b&&b.format?b:void 0,a=new Date(parseInt(a,10)),b?x.localizeDateByFieldInfo(a,b):x.localizeDate(a)):""},_checkAliasName:function(a){return"undefined"!==typeof a.alias?a.alias:!1},_checkDomainField:function(a){return"undefined"!==typeof a.domain?a.domain:!1},_checkDomainAndSubtype:function(a,
b,d){return a&&b&&d&&(a=x.getDisplayValueForCodedValueOrSubtype(a,b,d))&&a.isCodedValueOrSubtype&&"undefined"!==typeof a.displayValue?a.displayValue:!1},_checkDateField:function(a){return"esriFieldTypeDate"===a.type},_checkIntField:function(a){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)},_checkDisplayField:function(a,b){var c=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===b)return a[d];c=!1}return c},flashGraphics:function(a){for(var b=
0;b<a.length;b++)this._flashFeature(a[b])},_flashFeature:function(a){var b;if(a.geometry){var d=W.fromHex(this._styleColor),f=l.clone(d);f.a=.4;switch(a.geometry.type){case "point":b=new H(H.STYLE_CIRCLE,15,new G(G.STYLE_SOLID,d,1),f);break;case "polyline":b=new G(G.STYLE_SOLID,d,3);break;case "polygon":b=new O(O.STYLE_DIAGONAL_CROSS,new G(G.STYLE_SOLID,d,2),f)}}a=new w(a.geometry,b);this.map.graphics.add(a);if(b=a.getDojoShape())z.animateStroke({shape:b,duration:900,color:{start:b.strokeStyle.color,
end:b.strokeStyle.color},width:{start:25,end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type)var d=b.paths[Math.ceil(b.paths.length/2)-1],d=d[Math.ceil((d.length-1)/2)],b=new Z(d[0],d[1],b.spatialReference);"point"!==b.type&&(b=b.getExtent().getCenter());this._pan(a,b).then(l.hitch(this,function(){this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),
this.map.infoWindow.select(0),this.map.infoWindow.show(b)}))}},_pan:function(a,b){var c=new A;this.showAllFeatures&&!this.map.extent.contains(a.geometry)?this.map.centerAt(b).then(function(a){c.resolve(a)}):c.resolve(void 0);return c},_getQuery:function(a,b,d){var c=a.layerObject,e=new aa;e.geometry=this.showAllFeatures?null:this.map.extent;e.outFields=b;e.returnGeometry=d;b=["collection","kml","geo_rss"];a.selfType&&-1<b.indexOf(a.selfType)||!c.url?this.showAllFeatures&&c&&c.fullExtent&&(e.geometry=
c.fullExtent):e.where=a.filter?a.filter:"1\x3d1";return e},countFeatures:function(a){var b=new A;if(this.hidePanel)b.resolve(a);else{var d=a.layerObject,f="undefined"!==typeof a.visible?a.visible:d.visible,g=a.visScaleRange,k=this.config.countEnabled?a.node:a.legendNode,m=this._getQuery(a);d.queryCount&&d.visible?function(a){d.queryCount(m,l.hitch(this,function(c){if(k){var d;this.config.countEnabled?(k.innerHTML=x.localizeNumber(c),d=k.parentNode):d=k.previousSibling;this.updateExpand(d,g?0===c:
!0)}b.resolve(a)}))}.call(this,a):a&&a.li&&a.li.url&&f&&(-1<a.li.url.indexOf("MapServer")||-1<a.li.url.indexOf("FeatureServer"))?function(a){(new h(a.li.url)).executeForIds(m).then(l.hitch(this,function(c){if(k){var d=c?c.length:0;this.config.countEnabled?(k.innerHTML=x.localizeNumber(d),c=k.parentNode):c=k.previousSibling;this.updateExpand(c,g?0===d:!0)}b.resolve(a)}))}.call(this,a):b.resolve(a)}return b}})});